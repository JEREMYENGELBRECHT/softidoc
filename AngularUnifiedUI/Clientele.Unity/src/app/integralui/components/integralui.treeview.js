/*
  filename: integralui.treeview.js
  version : 1.0.0
  Copyright Â© 2016-2017 Lidor Systems. All rights reserved.

  This file is part of the "IntegralUI Web" Library. 
                                                                   
  The contents of this file are subject to the IntegralUI Web License, and may not be used except in compliance with the License.
  A copy of the License should have been installed in the product's root installation directory or it can be found at
  http://www.lidorsystems.com/products/web/studio/license-agreement.aspx.
                                                            
  This SOFTWARE is provided "AS IS", WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License for the specific language 
  governing rights and limitations under the License. Any infringement will be prosecuted under applicable laws.                           
*/
var __extends=this&&this.__extends||function(f,b){function a(){this.constructor=f}for(var c in b)b.hasOwnProperty(c)&&(f[c]=b[c]);f.prototype=null===b?Object.create(b):(a.prototype=b.prototype,new a)},__decorate=this&&this.__decorate||function(f,b,a,c){var d=arguments.length,e=3>d?b:null===c?c=Object.getOwnPropertyDescriptor(b,a):c,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(f,b,a,c);else for(var h=f.length-1;0<=h;h--)if(g=f[h])e=(3>d?g(e):3<d?g(b,a,e):
g(b,a))||e;return 3<d&&e&&Object.defineProperty(b,a,e),e},__metadata=this&&this.__metadata||function(f,b){if("object"===typeof Reflect&&"function"===typeof Reflect.metadata)return Reflect.metadata(f,b)},core_1=require("@angular/core"),integralui_core_1=require("./integralui.core"),integralui_common_service_1=require("../services/integralui.common.service"),integralui_data_service_1=require("../services/integralui.data.service"),integralui_dragdrop_service_1=require("../services/integralui.dragdrop.service"),
integralui_base_list_1=require("./integralui.base.list"),integralui_treeitem_1=require("./integralui.treeitem"),IntegralUITreeView=function(f){function b(a,c,b,e,g,h,k){f.call(this,a,c,b,e,g);this.dataService=a;this.dragDropService=c;this.elemRef=b;this.elemRenderer=e;this.commonService=g;this.cmpResolver=h;this.baseService=k;this.fullList=[];this.isThereChildItems=!1;this.blockSize={width:0,height:0};this.trialRef=null;this.afterCollapse=new core_1.EventEmitter;this.afterExpand=new core_1.EventEmitter;
this.beforeCollapse=new core_1.EventEmitter;this.beforeExpand=new core_1.EventEmitter;this.itemList=[]}__extends(b,f);Object.defineProperty(b.prototype,"dataFields",{set:function(a){this.updateDataFields(a)},enumerable:!0,configurable:!0});b.prototype.ngOnInit=function(){this.baseService.setComponent(this);this.dataService.init([{data:this.items}]);this.updateCurrentList();this.generalClassName="iui-treeview";this.initStyle()};b.prototype.ngAfterViewInit=function(){var a=this,c=setTimeout(function(){var b=
a.cmpResolver.resolveComponentFactory(integralui_core_1.IntegralUITComponent);b&&a.contentRef&&(a.trialRef=a.contentRef.createComponent(b));clearTimeout(c)},100)};b.prototype.ngAfterContentInit=function(){};b.prototype.ngOnDestroy=function(){this.removeDropMark();this.trialRef&&this.trialRef.destroy()};b.prototype.ngAfterContentChecked=function(){};b.prototype.ngAfterViewChecked=function(){};b.prototype.updateOptions=function(a){a?this.options={allowDrag:this.commonService.isFieldAvailable(a.allowDrag,
!1),allowDrop:this.commonService.isFieldAvailable(a.allowDrop,!0),dataFields:null,loadItems:[],selectedItem:this.commonService.isFieldAvailable(a.selectedItem,this.options.selectedItem?this.options.selectedItem:null)}:(this.options={allowDrag:!1,allowDrop:!0,dataFields:null,loadItems:[],selectedItem:null},this.updateDataFields())};b.prototype.updateDataFields=function(a){this.options.dataFields=a?{allowDrag:a.allowDrag?a.allowDrag:"allowDrag",allowDrop:a.allowDrop?a.allowDrop:"allowDrop",allowEdit:a.allowEdit?
a.allowEdit:"allowEdit",allowFocus:a.allowFocus?a.allowFocus:"allowFocus",autoCheck:a.autoCheck?a.autoCheck:"autoCheck",checkBoxSettings:a.checkBoxSettings?a.checkBoxSettings:"checkBoxSettings",checked:a.checked?a.checked:"checked",checkState:a.checkState?a.checkState:"checkState",content:a.content?a.content:"content",contextMenu:a.contextMenu?a.contextMenu:"contextMenu",enabled:a.enabled?a.enabled:"enabled",expanded:a.expanded?a.expanded:"expanded",hasChildren:a.hasChildren?a.hasChildren:"hasChildren",
icon:a.icon?a.icon:"icon",id:a.id?a.id:"id",items:a.items?a.items:"items",pid:a.pid?a.pid:"pid",statusIcon:a.statusIcon?a.statusIcon:"statusIcon",style:a.style?a.style:"style",templateObj:a.templateObj?a.templateObj:"templateObj",text:a.text?a.text:"text",tooltip:a.tooltip?a.tooltip:"tooltip",value:a.value?a.value:"value"}:{allowDrag:"allowDrag",allowDrop:"allowDrop",allowEdit:"allowEdit",allowFocus:"allowFocus",autoCheck:"autoCheck",checkBoxSettings:"checkBoxSettings",checked:"checked",checkState:"checkState",
content:"content",contextMenu:"contextMenu",enabled:"enabled",expanded:"expanded",hasChildren:"hasChildren",icon:"icon",id:"id",items:"items",pid:"pid",statusIcon:"statusIcon",style:"style",templateObj:"templateObj",text:"text",tooltip:"tooltip",value:"value"};this.dataService&&this.dataService.updateDataFields(this.options.dataFields)};b.prototype.getDataFields=function(){return this.options.dataFields};b.prototype.updateCurrentList=function(){var a=this;a.currentList.length=0;a.isThereChildItems=
!1;var c=a.dataService.getList();c&&c.forEach(function(c){a.addChildItems(c,null,!1)})};b.prototype.addChildItems=function(a,c,b,e){var d=this,f=!0;if(!a[d.options.dataFields.items])return f=d.addItemToCurrentList(a,c,b,e);if(f=d.addItemToCurrentList(a,c,b,e)){var k=0,l=!0;(b||d.isItemExpanded(a))&&(c=a[d.options.dataFields.items])&&c.forEach(function(c){(l=d.addChildItems(c,a[d.options.dataFields.id],b,a))&&k++});b||d.isThereChildItems||!(0<k||!d.isItemExpanded(a)&&a[d.options.dataFields.items]&&
0<a[d.options.dataFields.items].length&&d.isThereVisibleChildren(a))||(d.isThereChildItems=!0)}return f};b.prototype.addItemToCurrentList=function(a,b,d,e){a.type="item";a[this.options.dataFields.id]||(a[this.options.dataFields.id]=this.commonService.getUniqueId());b&&(a[this.options.dataFields.pid]=b);(b=this.isItemAllowed(a))&&(d?this.fullList.push(a):this.currentList.push(a));return b};b.prototype.loadData=function(a,b,d,e){this.processLoadData(a,b,d,e)};b.prototype.updateItem=function(a){var b=
this;if(a&&this.isItemExpanded(a))var d=setTimeout(function(){var c=b.getComponentFromItem(a);c&&!c.isBlockExpanded()&&c.toggleContent();clearTimeout(d)},100)};b.prototype.collapse=function(a){this.toggle(a,!1)};b.prototype.expand=function(a){this.toggle(a,!0)};b.prototype.toggle=function(a,b){if(a){if((a[this.options.dataFields.hasChildren]||a[this.options.dataFields.items]&&0!=a[this.options.dataFields.items].length)&&!(b&&0!=a[this.options.dataFields.expanded]||!1===b&&0==a[this.options.dataFields.expanded])){var c=
void 0!==b?b:!1!==a[this.options.dataFields.expanded]?!0:!1,c=void 0!=b?b:!c,e=this.getComponentFromItem(a);e&&(e.expanded=c)}}else(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(a){a.toggle(b,!0)})};b.prototype.getFullList=function(){this.fullList.length=0;var a=this.dataService.getList();if(a)for(var b=0;b<a.length;b++)this.addChildItems(a[b],null,!0);return this.fullList};b.prototype.getItemFromComponent=function(a){return a&&a.data?a.data:this.items&&
(this.itemList=this.contentList.toArray(),a=this.itemList.indexOf(a),0<=a&&a<this.items.length)?this.items[a]:null};b.prototype.getItemIndex=function(a){return this.itemList&&0<this.itemList.length?this.itemList.indexOf(a):-1};b.prototype.getParent=function(a){return this.dataService.getParent(a)};b.prototype.isChildOf=function(a,b){var c=!1;if(a&&b){var e=b[this.options.dataFields.items];if(e&&0<e.length)for(var f=0;f<e.length;f++){if(this.commonService.isEqual(a[this.options.dataFields.id],e[f][this.options.dataFields.id])){c=
!0;break}else c=this.isChildOf(a,e[f]);if(c)break}}return c};b.prototype.isItemExpanded=function(a){return a?a[this.options.dataFields.expanded]||void 0===a[this.options.dataFields.expanded]?!0:!1:!0};b.prototype.isParentOf=function(a,b){var c=this.dataService.getParent(b);return a&&b&&c&&this.commonService.isEqual(a[this.options.dataFields.id],c[this.options.dataFields.id])?!0:!1};b.prototype.isThereChildren=function(){return this.isThereChildItems};b.prototype.isThereVisibleChildren=function(a){var b=
!1;if(a&&(a=a[this.options.dataFields.items]))for(var d=0;d<a.length;d++)if(this.isItemAllowed(a[d])){b=!0;break}return b};b.prototype.invokeEvent=function(a,b){var c=!0;if(b){var e={cancel:!1,item:b};switch(a){case "AFTER_COLLAPSE":this.afterCollapse.emit({item:b});break;case "AFTER_EXPAND":this.afterExpand.emit({item:b});break;case "BEFORE_COLLAPSE":this.beforeCollapse.emit(e);c=!e.cancel;break;case "BEFORE_EXPAND":this.beforeExpand.emit(e),c=!e.cancel}}return c};b.prototype.invokeMethod=function(a,
b){var c=!0;if(b)switch(a){case "CHANGE_EXPANDED":this.changeExpanded(b.component);break;case "SELECT_ITEM":c=this.processSelection(b.event,b.item);break;case "UPDATE_SELECTION":this.updateSelection(b.event,b.item)}return c};b.prototype.changeExpanded=function(a){a&&a.data&&(a.data[this.options.dataFields.expanded]=a.expanded)};b.prototype.getContentSize=function(){return this.contentElem?{width:this.contentElem.nativeElement.offsetWidth,height:this.contentElem.nativeElement.offsetHeight}:{width:0,
height:0}};b.prototype.refresh=function(){this.clearComponentSelection();for(var a=0;a<this.currentSelectedItems.length;a++){var b=this.getComponentFromItem(this.currentSelectedItems[a]);b&&(b.state|=integralui_core_1.IntegralUIObjectState.selected)}if(this.contentList)for(this.itemList=this.contentList.toArray(),a=0;a<this.itemList.length;a++)this.itemList[a].refresh()};b.prototype.getComponentFromItem=function(a){var b=null;if((this.itemList=this.contentList.toArray())&&0<this.itemList.length)for(var d=
0;!b&&d<this.itemList.length;){b=this.itemList[d];if(this.getItemFromComponent(b)==a)break;else b=b.getComponentFromItem(a);d++}return b};b.prototype.updateLayout=function(){this.updateCurrentList();this.refresh();this.updateComplete.emit(null)};b.prototype.beginLoad=function(a){a&&0>this.options.loadItems.indexOf(a)&&this.options.loadItems.push(a)};b.prototype.endLoad=function(a){a=this.options.loadItems.indexOf(a);0<=a&&this.options.loadItems.splice(a,1)};b.prototype.isItemLoading=function(a){return 0<=
this.options.loadItems.indexOf(a)?!0:!1};b.prototype.clearComponentSelection=function(){this.contentList&&(this.itemList=this.contentList.toArray())&&0<this.itemList.length&&this.itemList.forEach(function(a){a.state&=~integralui_core_1.IntegralUIObjectState.selected;a.clearComponentSelection()})};__decorate([core_1.ViewChildren(integralui_treeitem_1.IntegralUITreeItem),__metadata("design:type",core_1.QueryList)],b.prototype,"contentList",void 0);__decorate([core_1.ViewChild("content",{read:core_1.ViewContainerRef}),
__metadata("design:type",core_1.ViewContainerRef)],b.prototype,"contentRef",void 0);__decorate([core_1.ViewChild("content",{read:core_1.ElementRef}),__metadata("design:type",core_1.ElementRef)],b.prototype,"contentElem",void 0);__decorate([core_1.ContentChild(core_1.TemplateRef),__metadata("design:type",Object)],b.prototype,"itemTemplate",void 0);__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],b.prototype,"dataFields",null);__decorate([core_1.Output(),
__metadata("design:type",core_1.EventEmitter)],b.prototype,"afterCollapse",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"afterExpand",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"beforeCollapse",void 0);__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],b.prototype,"beforeExpand",void 0);return b=__decorate([core_1.Component({selector:"iui-treeview",template:'\n\t\t<div [ngClass]="getControlClass()" (mouseenter)="onCtrlMouseEnter($event)" (mouseleave)="onCtrlMouseLeave($event)" (dragleave)="ctrlDragLeave($event)" (dragover)="ctrlDragOver($event)" (drop)="ctrlDragDrop($event)" (scroll)="onScroll($event)">\n\t\t\t<ul style="margin:0;padding:0;" #content>\n\t            <iui-treeitem *ngFor="let item of items" [text]="item.text" [templateRef]="itemTemplate" [data]="item" [items]="item.items">\n\t\t\t\t</iui-treeitem> \n\t\t\t</ul>\n\t\t</div>\n\t',
inputs:"allowDrag allowDrop appRef controlStyle data items selectedItem selectionMode state".split(" "),outputs:"afterSelect beforeSelect clear dragDrop dragOver itemAdding itemAdded itemRemoving itemRemoved loadComplete scrollPosChanged selectionChanged updateComplete".split(" "),providers:[integralui_core_1.IntegralUIBaseService,integralui_data_service_1.IntegralUIDataService]}),__metadata("design:paramtypes",[integralui_data_service_1.IntegralUIDataService,integralui_dragdrop_service_1.IntegralUIDragDropService,
core_1.ElementRef,core_1.Renderer,integralui_common_service_1.IntegralUICommonService,core_1.ComponentFactoryResolver,integralui_core_1.IntegralUIBaseService])],b)}(integralui_base_list_1.IntegralUIBaseList);exports.IntegralUITreeView=IntegralUITreeView;